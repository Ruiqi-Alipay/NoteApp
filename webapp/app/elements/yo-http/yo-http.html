<link rel="import" href="../../../components/polymer/polymer.html">
<link rel="import" href="../../../components/core-ajax/core-ajax.html">

<polymer-element name="yo-http">
	<template>
		<core-ajax id="ajax" handleAs="json"></core-ajax>
	</template>
	<script>
	(function () {
		Polymer({
	      makeRequest: function (scope, callback, url, method, params, body, contentType) {
	        var responseCallback = function (event) {
	          this.removeEventListener('core-response', responseCallback);
	          this.removeEventListener('core-error', errorCallback);

	          if (event.detail.response.success) {
	            callback(scope, event.detail.response.data, event.detail.response.ext);
	          } else {
	            this.fire('user-error', event.detail.response.toString());
	            callback(scope);
	          }
	        };
	        var errorCallback = function (event) {
	          this.removeEventListener('core-response', responseCallback);
	          this.removeEventListener('core-error', errorCallback);

	          this.fire('user-error', event.detail.response.toString());
	          callback(scope);
	        };

	        this.$.ajax.url = url;
	        if (contentType) {
	          this.$.ajax.contentType = contentType;
	        } else {
	          this.$.ajax.contentType = 'application/x-www-form-urlencoded';
	        }
	        
	        this.$.ajax.method = method;
	        this.$.ajax.params = params;
	        this.$.ajax.body = body ? JSON.stringify(body) : undefined;
	        this.$.ajax.addEventListener('core-response', responseCallback);
	        this.$.ajax.addEventListener('core-error', errorCallback);
	        this.$.ajax.go();
	      }
		});
	})();
	</script>
</polymer-element>












